<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Omas: Open MEI addressability service</title>

   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.css">
   <link rel="stylesheet" href="../css/style.css">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>-  
   <script src="../js/prism.js"></script>   


  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->


</head>

<body>
	<a href="https://github.com/umd-mith/ema/"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
  <div class="container">
  	<div class="row">
  		<div class="col-md-8">
			<img height="100px" src="images/omas-logo.png" alt="Omas"/>
  			<h2>Open MEI addressability service</h2>
  		</div>
  		<div class="col-md-4">
  			<a href="http://mith.umd.edu/research/project/enhancing-music-notation-addressability/">
  				<img height="130px" src="http://mith.umd.edu/wp-content/uploads/2014/07/header_ema.png"/>
  			</a>
  		</div>
  	</div>
    <div class="row" id="main">
      <div class="col-md-6">
      	<form id="requestInfo" class="well well-sm">
				  <div class="form-group">
				    <label for="meiUrl">MEI location</label>
				    <input type="url" class="form-control" id="meiUrl" value="http://go.umd.edu/bachtrio">
				  </div>
				  <button type="submit" class="btn btn-default">Request info</button>
				  <a href="#" class="btn btn-default" id="renderAllV"><i class="glyphicon glyphicon-music"></i> Preview MEI in Verovio</a>
				</form>
				<form id="sendSelection" class="well well-sm">
					<div class="form-group" id="g-measure">
				    <label>Which measures?</label>
				    <br/><small>Separate with commas, make ranges with hyphens, e.g. "1-2,4"</small>
					    <div>
					    	<input type="text" class="form-control" id="measures" value="1">
					    </div>
					    <div>
					    	<a href="#" class="btn btn-default" id="addstaves"><i class="glyphicon glyphicon-plus"></i> Add staves</a>
					    	<a href="#" class="btn btn-default collapse" id="resetstaves"><i class="glyphicon glyphicon-refresh"></i> Reset staves</a>
					    </div>
				    </div>
				    <div class="form-group" id="g-staves">
					    
				    </div>
				    <div class="form-group" id="g-beats">
					    
				    </div>				    
				</form>
      </div>
      <div class="col-md-6" id="info">
      	<ul class="nav nav-tabs" id="dataTabs" role="tablist">
				  <li role="presentation" class="active"><a href="#summary" aria-controls="summary" role="tab">Summary</a></li>
				  <li role="presentation"><a href="#json" aria-controls="json" role="tab">Json</a></li>
				  <li role="presentation"><a  href="#mei" aria-controls="mei" role="tab">Selection MEI</a></li>
				</ul>
				<div class="tab-content">
			    <div role="tabpanel" class="tab-pane active" id="summary">
			    	
			    </div>
			    <div role="tabpanel" class="tab-pane" id="json"></div>
			    <div role="tabpanel" class="tab-pane" id="mei"></div>
			  </div>
      </div>
    </div>
    <div class="row">
    	<div class="col-md-12" id="status"></div>
    </div>
  </div>

<script type="text/template" id="staff-tpl">
<label>Staves</label>
<div><small>Separate with commas, make ranges with hyphens, e.g. "1-2,4"</small></div>
<% _.each(measures, function(m){ %>
	<div class="row">
		<div class="col-xs-3">In measure <%=m%>:</div>
		<div class="col-xs-3">
			<input type="text" class="form-control" id="staves_for_m<%=m%>" value="1">
		</div>
		<div class="col-xs-6">
			<a href="#" data-ref="#staves_for_m<%=m%>" id="s_applyall">apply to all measures</a>
		</div>		
	</div>
<% 	});%>
<div>
	<a href="#" class="btn btn-default" id="addbeats"><i class="glyphicon glyphicon-plus"></i> Add beats</a>
	<a href="#" class="btn btn-default collapse" id="resetbeats"><i class="glyphicon glyphicon-refresh"></i> Reset beats</a>
</div>
</script>

<script type="text/template" id="beat-tpl">
<label>Beats</label>
<div><small>Separate with commas, make ranges with hyphens, e.g. "1-2,4"</small></div>
<% _.each(staves_by_measure, function(m){ 
	_.each(m.staves, function(s){ %>
		<div class="row">
			<div class="col-xs-3">In m <%=m.m_idx%>, staff <%=s%>:</div>
			<div class="col-xs-3">
				<input type="text" class="form-control" id="beats_for_m<%=m.m_idx%>_s<%=s%>" value="all">
			</div>
			<div class="col-xs-6">
				<div>
					<a href="#" data-ref="#beats_for_m<%=m.m_idx%>_s<%=s%>" id="b_applyalls">apply to all staves in measure</a>
				</div>
				<div>
					<a href="#" data-ref="#beats_for_m<%=m.m_idx%>_s<%=s%>" id="b_applyall">apply everywhere</a>
				</div>
			</div>		
		</div>
<% 	}); });%>
<div>
	<a href="#" class="btn btn-default" id="getselection">Get selection</a>
</div>
</script>

<script type="text/template" id="info-tpl">
	<table class="table">
		<tr>
			<td>Tot. measures</td><td><%=measures%></td>
		</tr>
		<tr>
			<td>Measure labels</td>
			<td>
			<% _.each(measure_labels.slice(0,5), function(ml, i) { %>
        <%=ml%><br/>
      <% }); %>
      <% if (measure_labels.length > 5) {%>
      	<div id="mmRest" class="collapse">
      		<% _.each(measure_labels.slice(5), function(ml, i) { %>
		        <%=ml%><br/>
		      <% }); %>
      	</div>
      	<a data-toggle="collapse" data-target="#mmRest" id="mmMore" href="#">
      		<small>...show more</small>
      	</a>
      <%}%>
			</td>
		</tr>
		<tr>
			<td>Staves</td>
			<td>
				<% _.each(staves, function(s, k) { %>
	        <%=s.length%> from measure <%=parseInt(k)+1%>
	        <a data-toggle="collapse" data-target="#st<%=k%>" href="#"><small>Labels</small></a>
	        <div id="st<%=k%>" class="collapse" style="margin-left: 1em;">
					<small>
						<% _.each(s, function(sl, i) { %>
	  					<%=i+1%>: "<%=sl%>"<br/>
  					<% }); %>
					</small>
				</div>
	      <% }); %>
			</td>
		</tr>
		<tr>
			<td>Beats</td>
			<td>
				<%
					var bmm = Object.keys(beats);
					bmm.sort();
					_.each(bmm.slice(0,5), function(bm) { %>
						<%=beats[bm].count%>/<%=beats[bm].unit%> from measure <%=parseInt(bm)+1%>
						<br/>
				<% }); %>
				<% if (bmm.length > 5) {%>
	      	<div id="beatsRest" class="collapse">
	      		<% _.each(bmm.slice(5), function(bm) { %>
			        <%=beats[bm].count%>/<%=beats[bm].unit%> from measure <%=parseInt(bm)+1%>
			        <br/>
			      <% }); %>
	      	</div>
	      	<a data-toggle="collapse" data-target="#beatsRest" id="beatsMore" href="#">
	      		<small>...show more</small>
	      	</a>
	      <%}%>
			</td>
		</tr>
	</table>
</script>

<script type="text/template" id="mei-tpl">
	<div class="bs-callout bs-callout-success">
		<h4>Selection URL</h4>
		<a href="<%=reqUrl%>"><%=reqUrl%></a>
	</div>
	<pre><code class="language-<%=lang%>"><%= data %></code></pre>
	<a href="#" class="btn btn-default" id="download"><i class="glyphicon glyphicon-download-alt"></i> Download</a>
	<a href="verovio.html" class="btn btn-default" id="renderV"><i class="glyphicon glyphicon-music"></i> Render with Verovio</a>
	<!--<a href="#" class="btn btn-default" id="renderM2VF"><i class="glyphicon glyphicon-music"></i> Render with MEI2VF</a>-->
</script>

<script src="../js/app.js"></script>

</body>
</html>
